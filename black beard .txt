local HttpService = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer

-- Ki·ªÉm tra xem Boss R√¢u ƒêen c√≥ trong server kh√¥ng
local function findBlackbeard()
    for _, npc in pairs(Workspace:GetChildren()) do
        if npc:IsA("Model") and npc.Name == "Blackbeard" then
            print("‚úÖ Boss R√¢u ƒêen ƒë√£ xu·∫•t hi·ªán!")
            return npc
        end
    end
    print("‚ùå Kh√¥ng t√¨m th·∫•y Boss, hop server...")
    return nil
end

-- L·∫•y danh s√°ch server ƒë·ªÉ hop
local function getServers()
    local url = "https://games.roblox.com/v1/games/2753915549/servers/Public?sortOrder=Asc&limit=100"
    local response = HttpService:GetAsync(url)
    local data = HttpService:JSONDecode(response)

    for _, server in pairs(data.data) do
        if server.playing < server.maxPlayers then
            return server.id
        end
    end
    return nil
end

-- T·ª± ƒë·ªông hop server
local function hopServer()
    local serverId = getServers()
    if serverId then
        print("üîÑ ƒêang chuy·ªÉn sang server m·ªõi...")
        TeleportService:TeleportToPlaceInstance(2753915549, serverId, Players.LocalPlayer)
    else
        print("‚ùå Kh√¥ng t√¨m th·∫•y server ph√π h·ª£p, th·ª≠ l·∫°i sau!")
    end
end

-- D·ªãch chuy·ªÉn ƒë·∫øn Boss
local function moveToBoss(boss)
    if boss then
        local character = player.Character
        if character and character:FindFirstChild("HumanoidRootPart") then
            print("üöÄ ƒêang di chuy·ªÉn ƒë·∫øn Boss...")
            character.HumanoidRootPart.CFrame = boss.HumanoidRootPart.CFrame + Vector3.new(0, 5, 0) -- Bay l√™n tr√™n boss m·ªôt ch√∫t
        end
    end
end

-- T·∫•n c√¥ng Boss li√™n t·ª•c
local function attackBoss(boss)
    if boss then
        print("‚öîÔ∏è B·∫Øt ƒë·∫ßu t·∫•n c√¥ng Boss R√¢u ƒêen...")
        RunService.RenderStepped:Connect(function()
            if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                player.Character.HumanoidRootPart.CFrame = boss.HumanoidRootPart.CFrame + Vector3.new(0, 5, 0)
            end
            -- G·ª≠i l·ªánh ƒë√°nh
            local CombatEvent = game:GetService("ReplicatedStorage"):FindFirstChild("Remotes"):FindFirstChild("Combat")
            if CombatEvent then
                CombatEvent:FireServer("Light_Beam") -- N·∫øu d√πng Light Fruit
                CombatEvent:FireServer("Melee") -- N·∫øu ƒë√°nh c·∫≠n chi·∫øn
            end
        end)
    end
end

-- Ch·∫°y script: ki·ªÉm tra boss, ƒë√°nh ho·∫∑c hop server
local boss = findBlackbeard()
if boss then
    moveToBoss(boss)
    attackBoss(boss)
else
    hopServer()
end
